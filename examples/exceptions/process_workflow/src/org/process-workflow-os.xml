<?xml version="1.0" encoding="UTF-8"?>

<?xml-stylesheet href="http://moise.sourceforge.net/xml/os.xsl" type="text/xsl" ?>

<organisational-specification
    id="process_workflow_exceptions" os-version="0.8"

    xmlns='http://moise.sourceforge.net/os'
    xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'>

    <structural-specification>

        <role-definitions>
            <role id="resourceManager" />
            <role id="projectManager" />
            <role id="designer1" />
            <role id="designer2" />
            <role id="designer3" />
            <role id="developer" />
            <role id="customer" />
        </role-definitions>

        <group-specification id="workflow_group">
            <roles>
                <role id="resourceManager" min="1" max="1" />
                <role id="taskManager" min="1" max="1" />
                <role id="designer1" min="1" max="1" />
                <role id="designer2" min="1" max="1" />
                <role id="designer3" min="1" max="1" />
                <role id="developer" min="1" max="1" />
                <role id="customer" min="1" max="1" />
                <role id="productOwner" min="1" max="1" />
                <role id="projectManager" min="1" max="1" />
            </roles>
        </group-specification>

    </structural-specification>

    <functional-specification>
        <scheme id="workflow_sch">

            <goal id="completeProduct">
                <plan operator="sequence">
                    <goal id="setup">
                        <plan operator="parallel">
                            <goal id="distributeResources" />
                            <goal id="allocateTasks" />
                        </plan>
                    </goal>
                    <goal id="design">
                        <plan operator="parallel">
                            <goal id="performDesign1" />
                            <goal id="performDesign2" />
                            <goal id="performDesign3" />
                        </plan>
                    </goal>
                    <goal id="consolidateSubdesigns" />
                    <goal id="buildProduct" />
                    <goal id="deliverProduct" ttf="10 seconds" />
                    <goal id="inspection" />
                </plan>
            </goal>

            <recovery-strategy id="r1">
                <properties>
                    <property id="when" value="goal-fault" />
                    <property id="target" value="distributeResources" />
                </properties>

                <exceptionType id="resourcePoaching">

                <goal id="raiseResourcePoaching" />
                <handling-policy id="hPoaching">
                    <properties>
                        <property id="when" value="always" />
                    </properties>
                    <goal id="redistributeResources" />
                </handling-policy>
            </recovery-strategy>

            <recovery-strategy id="r2">
                <exception id="designConflict">
                    <properties>
                        <property id="type" value="goal-failure" />
                        <property id="target" value="consolidateSubdesigns" />
                    </properties>
                    <goal id="raiseDesignConflict" />
                </exception>
                <handler id="hDesignConflict">
                    <goal id="solveConflicts" />
                </handler>
            </recovery-strategy>
            <recovery-strategy id="r3">
                <exception id="itemMisrouted">
                    <properties>
                        <property id="type" value="goal-failure" />
                        <property id="target" value="deliverProduct" />
                    </properties>
                    <goal id="raiseItemMisrouted" />
                </exception>
                <handler id="hItemMisrouted">
                    <goal id="notifyCustomer" />
                </handler>
            </recovery-strategy>

            <recovery-strategy id="r4">
                <exception id="itemDelayed">
                  <properties>
                      <property id="type" value="goal-deadline" />
                      <property id="target" value="deliverProduct" />
                  </properties>
                    <goal id="raiseItemDelayed" />
                </exception>
                <handler id="hItemDelayed">
                    <goal id="updateScheduling" />
                </handler>
            </recovery-strategy>

            <recovery-strategy id="r5">
                <exception id="agentUnavailable" when="???">
                    <goal id="..." />
                </exception>
                <handler id="hAgentUnavailable">
                    <goal id="..." />
                </handler>
            </recovery-strategy>

            <mission id="m1" min="1" max="1">
                <goal id="distributeResources" />
                <goal id="raiseResourcePoaching" />
            </mission>
            <mission id="m2" min="1" max="1">
                <goal id="allocateTasks" />
                <goal id="consolidateSubdesigns" />
                <goal id="raiseDesignConflict" />
            </mission>
            <mission id="m3" min="1" max="1">
                <goal id="performDesign1" />
            </mission>
            <mission id="m4" min="1" max="1">
                <goal id="performDesign2" />
            </mission>
            <mission id="m5" min="1" max="1">
                <goal id="performDesign3" />
            </mission>
            <mission id="m6" min="1" max="1">
                <goal id="buildProduct" />
            </mission>
            <mission id="m7" min="1" max="1">
                <goal id="deliverProduct" />
                <goal id="raiseItemMisrouted" />
                <goal id="raiseItemDelayed" />
            </mission>
            <mission id="m8" min="1" max="1">
                <goal id="inspection" />
            </mission>
            <mission id="m9" min="1" max="1">
                <goal id="completeProduct" />
                <goal id="redistributeResources" />
                <goal id="solveConflicts" />
                <goal id="notifyCustomer" />
                <goal id="updateScheduling" />
            </mission>

        </scheme>

    </functional-specification>

    <normative-specification>
        <norm id="n1" type="obligation" role="resourceManager" mission="m1" />
        <norm id="n2" type="obligation" role="taskManager" mission="m2" />
        <norm id="n3" type="obligation" role="designer1" mission="m3" />
        <norm id="n4" type="obligation" role="designer2" mission="m4" />
        <norm id="n5" type="obligation" role="designer3" mission="m5" />
        <norm id="n6" type="obligation" role="developer" mission="m6" />
        <norm id="n7" type="obligation" role="productOwner" mission="m7" />
        <norm id="n8" type="obligation" role="customer" mission="m8" />
        <norm id="n9" type="obligation" role="projectManager" mission="m9" />
    </normative-specification>

</organisational-specification>
